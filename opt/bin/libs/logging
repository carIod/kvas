#!/bin/sh
#------------------------------------------------------------------------------
#	ПАКЕТ КВАС
#------------------------------------------------------------------------------
#
#	Данный файл служит библиотекой переменных среды и функций,
#	которые используются в событийном пакете ndm
#	https://github.com/ndmsystems/packages/wiki/Opkg-Component
#
# ------------------------------------------------------------------------------
#	Разработчик: mail@zeleza.ru
#	Дата создания: 13/09/2022
#	Лицензия: GPL 2.0
# ------------------------------------------------------------------------------------------

LOG_ENABLE=YES
LINE_LEN=50

# ------------------------------------------------------------------------------------------
# Файл временного хранения результатов исполнения команды
# ------------------------------------------------------------------------------------------
res_file=/opt/tmp/kvas.result
# Функция печати двойной линии длинной LINE_LEN
dline=$(printf "%${LINE_LEN}s\n" | tr " " "=")
# Функции логирования результата
logger_dev()( [ "${LOG_ENABLE}" ] && logger "${1}" )

# ------------------------------------------------------------------------------------------
#
#	Функция логирования в журнал роутера и в stdin
#
# ------------------------------------------------------------------------------------------
log_when_error(){

#	Если логирование подключено
	[ "${LOG_ENABLE}" = "YES" ] && {
		operation_result="${1}"
		procedure_desc="${2//./}"
		if [ "${operation_result}" = 1 ]; then
			error_mess="${procedure_desc} произведена с ошибками."
			error_desc=$(cat "${res_file}")
			error "${error_mess}\n${dline}\n${error_desc}"
			logger "${error_mess}"
			logger "${error_desc}"
		fi
		rm -f "$(cat "${res_file}")"
	}
}
