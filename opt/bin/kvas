#!/bin/sh
. /opt/apps/kvas/bin/libs/vpn
. /opt/apps/kvas/bin/libs/check

#------------------------------------------------------------------------------
#
#	ПАКЕТ КВАС
#	файл ./kvas/bin/kvas -> /opt/bin/kvas
#
#------------------------------------------------------------------------------
#
#	Данный файл служит для запуска пакета КВАС из командной строки
#	и содержит основные команды запуска пакета:
#	Обработка получаемых аргументов скрипта
#	$1 - комманда для обработки
#	$2 - аргумент для работы команды (опционно)
#
# ------------------------------------------------------------------------------
#	Разработчик: mail@zeleza.ru
#	Дата создания: 21/05/2022
#	Лицензия: GPL 2.0
# ------------------------------------------------------------------------------

APP_VERSION=
APP_RELEASE=

clear_file_content "${UNBLOCK_LIST_FILE}"

print_line
case "${1}" in
	bridge)
		case "${2}" in
			add ) 			cmd_bridge_vpn_access_add "${3}" ;;
			del ) 			cmd_bridge_vpn_access_del "${3}" ;;
			*) 				cmd_bridge_vpn_access_list ;;
		esac
		;;
	dnsmasq)
		case "${2}" in
			port) 			cmd_dnsmasq_port_change "${3}" ;;
			ip) 			cmd_dnsmasq_dns_change "${3}";;
			status | *) 	cmd_dnsmasq_listen_show;
							cmd_dnsmasq_port_show ;;
		esac
		;;
	ssr)
		case "${2}" in
			new)			cmd_shadowsocks_read_new_data ;;
			port) 			cmd_shadowsocks_local_port_change "${3}" ;;
			reset) 			cmd_shadowsocks_iptable_reset ;;
			status | *) 	cmd_vpn_status ;;
		esac
		;;

	adguard)
		case "${2}" in
			on) 			cmd_adguardhome_on ;;
			off) 			cmd_adguardhome_off ;;
			test)			cmd_adguard_check ;;
			*) 				cmd_adguardhome_status ;;
		esac
		;;

	dns)
		case "${2}" in
			test) 			cmd_dns_test ;;
			*) 				cmd_dnsmasq_dns_change "${2}" ;;
		esac
		;;

	vpn)
		case "${2}" in
			set) 			cmd_interface_change aks ;;
			reset) 			cmd_vpn_iptable_reset ;;
			guest) 	        cmd_vpn_guest_network "${3}" ;;
			del|rm) 	    cmd_vpn_del_guest_network ;;
			rescan|scan)	cmd_scan_interface_list ;;
			status | *) 	cmd_vpn_status ;;
		esac
		;;

	crypt | dnscrypt)
		case "${2}" in
			on) 			cmd_dns_crypt_on ;;
			off) 			cmd_dns_crypt_off ;;
			status | *) 	cmd_dns_crypt_status_show ;;
		esac
		;;

	adblock | ads)
		case "${2}" in
			on) 			cmd_ads_protect_on ask;;
			off) 			cmd_ads_protect_off ;;
			edit) 			cmd_ads_edit ;;
			status | *) 	cmd_ads_status ;;
		esac
		;;

	debug)
		case "${2}" in
			nofiles) 		cmd_print_debug "${2}" ;;
			*) 				cmd_print_debug '' ;;
		esac
		;;
	test | check)			cmd_state_checker
		;;
	add | new)				cmd_add_one_host "${2}"
		;;
	import)					cmd_import_hosts "${2}"
		;;
	export)					cmd_export_hosts "${2}"
		;;
	del | rm)				cmd_del_one_host "${2}"
		;;
	purge | clear)			cmd_clear_list "${2}"
		;;
	show | list)			cmd_show_list
		;;
	period)					cmd_set_period_update "${2}"
		;;
	update)					cmd_update_list
		;;
	version | ver)			warning "Версия скрипта ${APP_VERSION}-${APP_RELEASE}"
		;;
	help ) 					cmd_help
		;;
	*)						cmd_show_list
		;;
esac

print_line
