#!/bin/sh
# ------------------------------------------------------------------------------------------
#
# 	ПРОЕКТ КВАС
#
# ------------------------------------------------------------------------------------------
# 	Данный файл служит основной библиотекой функций пакета КВАС
# ------------------------------------------------------------------------------------------
#	Разработчик: kvas@zeleza.ru
#	Дата: 18/01/2024
#	Лицензия: Apache License 2.0
# ------------------------------------------------------------------------------------------

#	Подключаем библиотеку с функциями обработки ndm
. /opt/apps/kvas/bin/libs/ndm_d
. /opt/apps/kvas/bin/libs/ndm

if [ "${1}" = "hook" ] && [[ ${id} =~ 'PPTP|L2TP' ]]; then

		# Отслеживаем, когда подключается к провайдеру через соединения типа PPTP или L2TP
		[ "${layer}-${level}" = "ctrl-running" ] && {
			# В случае наличия глобального флага у текущего
			# соединения - переустанавливаем ipset правила
			is_cli_iface_global "${id}" && cmd_vpn_iptable_reset
			logger -t "КВАС"  "Соединение ${id} успешно подключено."
		}

fi
