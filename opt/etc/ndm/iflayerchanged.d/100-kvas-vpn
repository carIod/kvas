#!/bin/sh
# ------------------------------------------------------------------------------------------
#
# 	ПРОЕКТ КВАС
#
# ------------------------------------------------------------------------------------------
# 	Данный файл служит основной библиотекой функций пакета КВАС
# ------------------------------------------------------------------------------------------
#	Разработчик: kvas@zeleza.ru
#	Дата: 18/01/2024
#	Лицензия: Apache License 2.0
# ------------------------------------------------------------------------------------------

#	Подключаем библиотеку с функциями обработки ndm
# shellcheck source=opt\bin\libs\ndm_d
. /opt/apps/kvas/bin/libs/ndm_d

local cli_inface
cli_inface="$(get_config_value "INFACE_CLI")"

if [ "${1}" = "hook" ] && echo "${id}" | grep -q "${cli_inface}"; then

	case "${layer}-${level}" in

#		Запускаем обработку при поднятии соединения
		"ctrl-running")
			cmd_vpn_iptable_reset &> /dev/null
#			link_up &> /dev/null
			logger -t "КВАС"  "Соединение ${id} успешно подключено."
		;;

#		Запускаем обработку при отключении соединении
		"ctrl-disabled" )
			link_reboot "${cli_inface}" &> /dev/null
			logger -t "КВАС"  "Соединение ${id} успешно завершено."
		;;

	esac

fi

