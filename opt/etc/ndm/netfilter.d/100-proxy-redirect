#!/bin/sh
. /opt/apps/kvas/bin/libs/ndm

#------------------------------------------------------------------------------
#
#	ПАКЕТ КВАС
#
#------------------------------------------------------------------------------
#
#	Данный файл служит для создания правил для пропуска Shadowsocks трафика (tcp)
#	при использовании любого shadowsocks подключения.
#	Они срабатывают при пепезаписи правил в таблице netfilter
#	https://github.com/ndmsystems/packages/wiki/Opkg-Component
#
# ------------------------------------------------------------------------------
#	Разработчик: mail@zeleza.ru
#	Дата создания: 21/05/2022
#	Лицензия: GPL 2.0
# ------------------------------------------------------------------------------

# Shadowsocks+
if ! ip4save | grep "${table_name}" | grep -q @PROXY_PORT ; then
#	 создаем таблицу ipset и првила для shadowsocks подключения
	ipset4_create_table
	ip4_firewall_flush_vpn_rules
	ip4_firewall_set_ssr_rules @INFACE @PROXY_PORT
fi

exit 0
